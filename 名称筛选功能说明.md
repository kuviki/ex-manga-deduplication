# 名称筛选功能说明

## 功能概述

在漫画去重工具中新增了"按名称筛选"功能，该功能位于主窗口的筛选设置区域，在"按修改时间筛选"功能的下方。

## 功能特性

### 1. 名称筛选开关
- 提供一个复选框来启用/禁用名称筛选功能
- 当禁用时，名称筛选输入框会变为灰色不可编辑状态

### 2. 正则表达式支持
- 支持使用正则表达式作为黑名单规则
- 匹配到的漫画文件将被排除，不参与去重扫描
- 输入框提供了友好的占位符提示："例如: .*test.*|.*demo.*"

### 3. 设置持久化
- 所有筛选设置（包括名称筛选）会自动保存到配置文件中
- 应用程序重启后会自动加载之前的筛选设置

## 使用方法

### 基本使用
1. 在主窗口的筛选设置区域找到"按名称筛选"选项
2. 勾选复选框启用名称筛选功能
3. 在输入框中输入正则表达式规则
4. 开始扫描时，匹配规则的文件将被自动排除

### 正则表达式示例

#### 排除包含特定关键词的文件
```regex
.*test.*|.*demo.*|.*sample.*
```
这将排除文件名中包含 "test"、"demo" 或 "sample" 的所有文件。

#### 排除特定前缀的文件
```regex
^temp_.*|^backup_.*
```
这将排除以 "temp_" 或 "backup_" 开头的文件。

#### 排除特定扩展名的文件
```regex
.*\.(tmp|temp|bak)$
```
这将排除扩展名为 .tmp、.temp 或 .bak 的文件。

#### 排除特定模式的文件
```regex
.*_\d{8}_.*
```
这将排除文件名中包含8位数字（如日期）的文件，例如 "manga_20231201_backup.zip"。

## 技术实现

### 配置管理
- 在 `ConfigManager` 类中添加了筛选设置的管理方法
- 默认配置包含所有筛选选项的初始状态
- 提供 `get_filter_settings()` 和 `set_filter_settings()` 方法

### UI组件
- 在主窗口中添加了名称筛选的复选框和输入框
- 实现了开关状态联动，确保用户体验的一致性
- 在扫描开始前自动保存当前的筛选设置

### 扫描逻辑
- 在 `Scanner` 类的 `scan_directory` 方法中添加了 `name_filter_regex` 参数
- 在 `_process_single_comic` 方法中实现了名称筛选逻辑
- 包含错误处理，确保无效的正则表达式不会导致程序崩溃

## 错误处理

### 正则表达式错误
- 如果输入的正则表达式语法错误，系统会记录警告日志
- 错误的正则表达式不会中断扫描过程
- 建议用户在使用复杂正则表达式前先进行测试

### 调试信息
- 当文件被名称筛选排除时，会记录调试级别的日志
- 日志格式：`文件被名称筛选排除: {文件路径}`

## 注意事项

1. **性能影响**：正则表达式匹配会对扫描性能产生轻微影响，建议使用简单高效的表达式
2. **大小写敏感**：正则表达式匹配是大小写敏感的，如需忽略大小写可使用 `(?i)` 标志
3. **文件路径匹配**：匹配的是文件的基本名称（不包含路径），而非完整路径
4. **设置保存**：筛选设置在每次开始扫描时自动保存，无需手动保存

## 测试验证

项目中包含了 `test_name_filter.py` 测试脚本，可以验证：
- 配置管理器的筛选设置功能
- 正则表达式筛选逻辑的正确性
- 各种常见使用场景的测试用例

运行测试：
```bash
python test_name_filter.py
```