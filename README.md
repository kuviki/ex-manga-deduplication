# 漫画去重工具

一个功能强大的漫画重复文件检测工具，支持多种压缩格式和图像哈希算法。

## 功能特性

### 核心功能
- **多格式支持**: 支持 ZIP、RAR、CBZ、CBR 格式的漫画文件
- **智能检测**: 使用多种图像哈希算法进行重复检测
- **可配置阈值**: 支持自定义相似度阈值和最小相似图片数量
- **图片预览**: 提供漫画内容预览功能
- **批量操作**: 支持批量删除重复文件

### 高级功能
- **黑名单管理**: 排除不需要检测的图片
- **结果缓存**: 缓存扫描结果，提高后续扫描速度
- **扫描控制**: 支持暂停、恢复和停止扫描
- **纯内存读取**: 无需解压文件即可读取内容
- **模块化设计**: 易于扩展和维护

### 用户界面
- **直观操作**: 简洁易用的图形界面
- **实时进度**: 显示扫描进度和状态
- **详细信息**: 展示文件大小、图片数量等信息
- **右键菜单**: 便捷的文件操作选项
- **设置面板**: 丰富的配置选项

## 系统要求

- **操作系统**: Windows 10/11
- **Python**: 3.9 或更高版本
- **内存**: 建议 2GB 或以上
- **存储**: 至少 100MB 可用空间

## 安装说明

### 1. 克隆项目
```bash
git clone <repository-url>
cd Ex-Deduplication2
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 运行程序
```bash
python main.py
```

## 使用指南

### 基本使用

1. **选择扫描目录**
   - 点击"浏览"按钮选择包含漫画文件的目录
   - 支持递归扫描子目录

2. **开始扫描**
   - 点击"开始扫描"按钮
   - 程序会自动检测重复的漫画文件
   - 可以随时暂停或停止扫描

3. **查看结果**
   - 扫描完成后，重复文件会按组显示
   - 点击文件可以预览漫画内容
   - 查看文件详细信息

4. **删除重复文件**
   - 选择要删除的文件
   - 点击"删除选中"按钮
   - 支持智能选择（每组保留一个）

### 高级设置

#### 哈希算法设置
- **感知哈希 (pHash)**: 适合检测相似图片
- **差异哈希 (dHash)**: 快速检测，适合大量文件
- **平均哈希 (aHash)**: 基础算法，速度最快
- **小波哈希 (wHash)**: 高精度检测

#### 检测参数
- **相似度阈值**: 控制检测敏感度（0-100）
- **最小相似图片数**: 判定为重复的最少相似图片数量
- **最小分辨率**: 忽略低分辨率图片

#### 应用设置
- **漫画查看器路径**: 设置外部查看器程序
- **错误处理方式**: 选择遇到错误时的处理策略
- **窗口尺寸**: 自定义界面大小
- **预览图尺寸**: 调整预览图片大小

#### 高级选项
- **最大工作线程数**: 控制并发处理数量
- **启用缓存**: 开启结果缓存功能
- **缓存过期时间**: 设置缓存有效期
- **黑名单文件路径**: 指定黑名单存储位置

### 黑名单管理

1. **添加黑名单**
   - 通过"工具" -> "黑名单管理"打开管理界面
   - 导入图片文件自动计算哈希值
   - 手动添加哈希值

2. **管理黑名单**
   - 查看已添加的黑名单项
   - 删除不需要的项目
   - 导出/导入黑名单文件

3. **应用黑名单**
   - 扫描时自动排除黑名单中的图片
   - 提高检测准确性

## 配置文件

程序会在用户目录下创建配置文件：
- `%USERPROFILE%/.comic_deduplicator/config.ini`: 主配置文件
- `%USERPROFILE%/.comic_deduplicator/blacklist.json`: 黑名单文件
- `%USERPROFILE%/.comic_deduplicator/cache/`: 缓存目录

## 故障排除

### 常见问题

**Q: 程序启动失败**
A: 检查 Python 版本和依赖包是否正确安装

**Q: 扫描速度很慢**
A: 尝试调整线程数量，或启用缓存功能

**Q: 检测结果不准确**
A: 调整相似度阈值和最小相似图片数量

**Q: 无法打开某些 RAR 文件**
A: 确保系统已安装 WinRAR 或 7-Zip

**Q: 内存使用过高**
A: 减少最大工作线程数，或分批处理大量文件

### 日志文件

程序会生成详细的日志文件，位于：
- `logs/comic_deduplicator.log`

查看日志可以帮助诊断问题。

## 开发说明

### 项目结构
```
Ex-Deduplication2/
├── main.py                 # 程序入口
├── requirements.txt        # 依赖包列表
├── README.md              # 说明文档
├── src/                   # 源代码目录
│   ├── __init__.py
│   ├── core/              # 核心功能模块
│   │   ├── __init__.py
│   │   ├── config_manager.py
│   │   ├── image_hash.py
│   │   ├── archive_reader.py
│   │   ├── blacklist_manager.py
│   │   ├── scanner.py
│   │   └── cache_manager.py
│   ├── gui/               # 用户界面模块
│   │   ├── __init__.py
│   │   ├── main_window.py
│   │   ├── settings_dialog.py
│   │   ├── duplicate_list_widget.py
│   │   ├── image_preview_widget.py
│   │   ├── blacklist_dialog.py
│   │   └── about_dialog.py
│   └── utils/             # 工具模块
│       ├── __init__.py
│       ├── file_utils.py
│       ├── image_utils.py
│       └── ui_utils.py
└── logs/                  # 日志目录
```

### 扩展开发

1. **添加新的哈希算法**
   - 在 `image_hash.py` 中实现新算法
   - 更新配置选项

2. **支持新的文件格式**
   - 扩展 `archive_reader.py`
   - 添加格式检测逻辑

3. **自定义界面组件**
   - 在 `gui/` 目录下添加新组件
   - 集成到主窗口

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request！

## 更新日志

### v1.1.0 (性能优化版本)
- **重大性能提升**: 使用numpy矩阵计算重写重复检测算法
- **处理速度**: 平均达到5000+图片/秒的处理速度
- **算法优化**: 实现了specification.md中提到的高效矩阵计算方案
- **内存优化**: 减少了重复计算，提高了内存使用效率
- **向量化计算**: 利用numpy的广播机制进行批量汉明距离计算

### v1.0.0
- 初始版本发布
- 支持基本的重复检测功能
- 图形用户界面
- 黑名单管理
- 结果缓存

## 联系方式

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- Email: [your-email@example.com]

---

感谢使用漫画去重工具！