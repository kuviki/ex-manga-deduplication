# Ex-漫画去重工具

这是一个智能的漫画重复检测和管理工具，帮助您轻松整理大量的漫画收藏。目标是方便漫画的整理，特别适合用于处理大量的漫画档案，节省手动整理的时间。

## 漫画格式

漫画是 **rar** 或 **zip** 格式打包的压缩包，里面包含 **jpg**、**png**、**gif** 等格式的图片，压缩包中可以包含文件夹，图片可以任意命名，支持黑白漫画和彩色漫画，压缩包无密码，压缩包内可以包含非图片文件。

## 比对方式

通过图片哈希进行相似性比对，根据相似度阈值判断是否为相似图片，两个漫画大于指定数量（可配置）的相似图片则视为重复漫画。如果是 **gif** 等动图格式的图片，则取第一帧去比对。
支持多种图片哈希算法。

### 高效实现

在重复漫画检测时，先把所有漫画的图片哈希组成一个 numpy 数组，再生成一个图片数量长度的表示图片所在漫画索引的 numpy 数组，再for循环所有漫画，把单个漫画中的图片哈希组成另一个 numpy 数组，再把两个数组进行矩阵计算得到当前漫画图片和所有漫画图片的相似度，再与相似度阈值比较得到掩码数组，再用掩码数组筛选图片所在漫画索引得到重复漫画的索引数组并去重，最终就能得到重复漫画的索引。

## 可配置的设置

- 图片哈希算法选择
- 图片相似度阈值：不同的哈希算法单独设置阈值
- 重复漫画最小相似图片数量
- 漫画查看器路径：用于双击漫画时调用的漫画查看器程序，为空时用默认关联程序打开漫画
- 遇到错误的处理方式：可以选择询问、跳过、中止扫描
- 图片最小分辨率：用于排除一些尺寸太小的图片
- ...

## 图像界面

- 参数设置
- 扫描进度条
- 重复漫画列表
- 显示漫画中重复图片的侧栏
- 图片列表
- 图片预览
- 漫画批量选择
- 漫画删除二次确认弹窗
- ...

## 特色功能

- **黑名单图片**：部分漫画包含广告、推广二维码等图片，在图片预览时可以把其加入到黑名单，并且可以立即更新重复漫画结果，排除黑名单中的图片
- **结果缓存**：保存扫描结果便于下一次使用，下一次扫描时，如果漫画压缩包的修改日期不变且哈希算法相同，就可以复用该漫画之前的扫描结果
- **扫描暂停继续**：扫描过程中可以暂停
- **纯内存读取**：直接在内存中读取压缩包的图片，无需解压到磁盘
- **模块化设计**：每个功能模块独立，便于维护和扩展
- ...

## 系统要求
- Python 3.9 或更高版本
- Windows 10/11 (推荐)
- 至少 2GB 可用内存

## 使用方法

1. 设置相似度阈值、最小相似图片数量等参数。
2. 选择漫画档案的目录路径。
3. 点击扫描按钮，等待扫描进度条完成，中途可以暂停扫描，遇到错误可以选择跳过或重试。
4. 在重复漫画列表中选中漫画，可以右键菜单中打开文件路径。
5. 选中漫画后可在侧栏中查看重复的图片，可以右键菜单中把图片加入黑名单。
6. 选好漫画后，点击删除按钮，在弹出的确认窗口点确认即可删除重复漫画到回收站。